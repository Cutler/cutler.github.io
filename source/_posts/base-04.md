title: 第四章 Linux
date: 2016-7-15 18:06:20
categories: 编程基础
---
　　本章来介绍一下Linux系统基础知识，主旨是为大家日后深入学习Linux做铺垫。

# 第一节 基础入门 #
## 为什么要学习Linux ##
　　Linux应用广泛，从嵌入式设备、服务器领域到超级电脑，它都发挥着相当重要的作用。

	-  在嵌入式领域，流行的TiVo数字视频录像机还采用了定制的Linux，思科在网络防火墙和路由器也使用了定制的Linux。Linux也用于舞台灯光控制系统，如WholeHogIII控制台。在智能手机、平板电脑等移动设备方面，基于Linux内核的Android操作系统已经成为当今全球最流行的智能手机操作系统。
	-  在服务器领域，根据2006年9月Netcraft的报告显示，十个最大型的网络托管公司有八个公司在其Web服务器运行Linux发行版。Linux发行版是构成LAMP（Linux操作系统，Apache，MySQL，Perl / PHP / Python）的重要部分，LAMP是一个常见的网站托管平台，在开发者中已经得到普及。

　　因此笔者可以毫不负责任的说，一个程序员如果对Linux一窍不通的话，是说不过去的，更何况我们还是Android程序员。

## Linux常识 ##
　　如果你想了解Linux历史的话，可以去看看[《Linux入门很简单》](http://download.csdn.net/detail/baokx/8435171)一书，同时推荐一个Linux的学习网站： [实验楼](https://www.shiyanlou.com/)。
<br>**发行版与内核**
　　刚开始接触Linux时你一定会看到`Linux发型版`和`Linux内核`这两个概念，推荐大家去阅读[《扫盲 Linux：如何选择发行版》](https://program-think.blogspot.com/2013/10/linux-distributions-guide.html)，这篇文介绍的很详细，为了防止遗失笔者下面就把部分内容摘抄过来。

	1、"操作系统内核"，通俗地说就是操作系统最核心最关键的部件。它负责一些最基本的工作，比如：管理硬件驱动、管理内存、管理文件系统、管理进程、等等。这些工作只要少了任何一样，整个操作系统都没法运转。
	2、Linux 作为操作系统，当然也有其内核。Linux 内核的特点是彻底的开放性，即任何人都可以随意获取、免费获取、参与开发。
	3、操作系统都有"内核"的概念（比如 Windows 也有其内核）。但如果你使用 Windows，通常感觉不到"内核"的存在。为啥捏？原因在于：微软是把 Windows 当作一个整体来发布的。对于普通用户而言，你拿到的是一个完整的操作系统，所以你感觉不到"内核"的存在。而 Linux 不同于其它操作系统的地方在于：Linus 领导的开源社区只负责开发内核，不开发其它的东西（比如：运行库、图形界面、应用软件、等）。
	4、这就引出一个问题——光有一个赤裸裸的内核，用户是没法用的（就好比你光拿到一个汽车引擎，你是没法开车的）。为此，就有一大帮开源社区或商业公司，在这个裸露的内核外面，再包上一些东西（比如：运行库、应用软件）。经过这样包装之后，就成为"发行版"。为啥 Linux 的发行版如此之多捏？前面俺说了，Linux 内核是彻底开放的，随便什么阿猫阿狗都可以去 Linux 的官网下载到内核。于是，发行版自然就很多啦。

<br>**通用发行版 VS 专用发行版**

	1、所谓的"通用发行版"，顾名思义就是：这个发行版可以派上各种用场；反之，"专用发行版"是为特定用途设计，只能用于某些特定场合。
    2、通用发行版名气比较大的有：Debian（非常强调"自由"的开源理念，它有很多衍生的发行版，形成一个大家族。）、Fedora、Slackware等。
    3、面向客户端（桌面）的专用发行版名气比较大的有：Ubuntu Desktop（衍生自Debian）、Mageia等。Ubuntu Desktop以发布时间做版本号（比如13.10 就是2013年10月发布）。每半年发布一个版本。它的版本分两种：普通版本和长期支持版本（LTS）。LTS 会持续提供支持（补丁更新）长达几年（桌面版 3年，服务器版 5年），普通版本只支持9个月。
    4、面向服务端的专用发行版名气比较大的有：Red Hat Enterprise Linux（简称 RHEL）、CentOS（从 RHEL 衍生）、Ubuntu Server（从 Debian 衍生）等等。

<br>**Shell**

	1、Shell是一个用C语言编写的应用程序，它提供了一个用户界面，用户通过在这个界面输入命令来访问操作系统内核的服务。
    2、为了防止重复编写代码，我们将一组Shell命令写在文件中，每次需要的时候就执行一下文件即可，这个文件就被称为Shell脚本。
    3、在 UNIX/Linux 中比较流行的 Shell 有 bash，zsh，ksh，csh 等等，Ubuntu 终端默认使用的是 bash。

<br>
**本节参考阅读：**
- [维基百科 - Linux](https://zh.wikipedia.org/wiki/Linux)

## 目录结构及文件基本操作 ##
　　与Windows将硬盘看做“C盘”、“D盘”几个独立的分区不同，Linux将整个文件系统看做一棵树，这棵树的树根叫做根文件系统，用“/”表示。各个分区通过“挂载”（Mount）以文件夹的形式访问。

　　其中“/”下的文件夹有很多，大家可以去 [维基百科-FHS](https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E6%A0%87%E5%87%86) 中了解详细信息，简单的说：

	-  多数Linux发行版遵从FHS标准来设计自己的目录结构，在FHS中，所有的文件和目录都出现在根目录"/"下，即使他们存储在不同的物理设备中。
	-  虽然FHS规定了很多目录，但是这些目录都有各自的作用，当你掌握后，你就会发现一切都变得井然有序。

　　主要的目录有如下几个：

	/bin：存放操作系统运行所需要的可执行文件，所有用户都有权访问，例如：cat、ls、cp等命令。
    /boot：存放启动Linux时使用的一些核心文件，例如：kernal（系统内核）、initrd等。
    /dev：存放系统中的设备，从此目录可以访问各种系统设备，如磁盘驱动器，调制解调器，CPU，USB等。
    /etc：存放系统和应用软件的配置文件。
    /home：存放普通用户的个人文件。每个用户的主目录均在/home下以自己的用户名命名。
    /lib：存放/bin和/sbin中二进制文件所需要的库文件。
    /media：可移动设备的挂载点(如CD-ROM)。
    /mnt：临时挂载的文件系统。
    /opt：多数第三方软件默认安装到此位置，但并不是每个系统都会创建这个目录。
    /proc：虚拟文件系统，里面保存了内核和进程的状态信息，多为文本文件，可以直接查看。如/proc/cpuinfo保存了有关CPU的信息。
    /root：这是根用户的主目录。与保留给个人用户的/home下的目录很相似，该目录中还包含仅与根用户有关的条目。
    /sbin：root用户才能使用的系统二进制文件，例如： init、 ip、 mount等。
    /tmp：该目录用来保存临时文件，在系统重启时目录中文件不会被保留。
    /usr：用于存储只读用户数据的第二层次； 包含绝大多数的(多)用户工具和应用程序。
    /var：变量文件——在正常运行的系统中其内容不断变化的文件，如日志，脱机文件和临时电子邮件文件。有时是一个单独的分区。

<br>　　接下来介绍几个文件相关的常用Shell命令。

<br>　　范例1：文件操作。
``` shell
# 使用mkdir命令，在当前目录下创建一个名为myDir的文件夹。
# 在mkdir命令后面跟随“-p”可以连父目录一起创建（如果不存在的话）。
mkdir myDir

# 使用cd命令，进入到myDir文件夹中。
cd myDir

# 使用touch命令创建文件，如果想同时创建多个，那多个文件名之间使用空格间隔。
touch b.txt c.txt

# 使用ls命令，列出当前文件夹下的所有文件。在ls命令后面跟随“-l”参数可以同时把文件的详细信息列出来。
ls

# 使用rm命令，删除文件。其中*是通配符，表示删除所有文件，但不能删文件夹。
rm *

# 使用pwd命令查看当前所处的目录。
pwd
```
    语句解释：
    -  上面只是简单的介绍了各个命令，一般情况下每个命令都可以接受若干个参数。
    -  比如若你想使用rm命令删除一个文件夹，可以使用“rm -r myDir”，其中-r会删除myDir以及其内的所有文件。
    -  各命令的语法就不细说了，网上很容易搜索到。

<br>　　范例2：查找命令。
``` shell
# 使用find命令查找文件，下面命令的含义：从当前目录下的test目录中查找后缀名为txt的文件。
# 其中-name参数用来告诉find命令，按照文件名去查找，言外之意就是find命令还可以按照其它方式查找，比如文件权限等。
# 如果不指定查找的目录，则默认使用当前目录。
find test -name *.txt

# 使用grep命令查找文件里的内容，下面命令的含义：从test目录下的所有txt文件中搜索Hello关键字。
# 在grep命令后面加上-n参数可以把行号给列出来。
grep Hello test/*.txt
```
    语句解释：
    -  find和grep命令有很多附加参数，这里没法一一介绍，各位请自行搜索。

<br>　　范例3：复制、移动、重命名。
``` shell
# 使用cp命令复制文件，下面命令的含义：将当前目录下的b.txt复制到上一级目录中，并将复制过去的文件改名为bb.txt。
# 如果你想复制文件夹，可以在后面加一个-r参数。
cp b.txt ../bb.txt

# 使用mv命令移动文件，移动文件夹不需要夹任何参数。
mv b.txt ../
```
    语句解释：
    -  也可以用mv命令给文件和文件夹重命名，比如mv b.txt newb.txt。
    -  批量重命名可以使用rename命令，具体请自行搜索。

<br>　　范例4：查看与编辑。
``` shell
# 使用cat命令，可以把文件的全部内容给拿出来，使用-n参数可以加上行号。
cat -n result.txt

# 使用nl命令，也可以把文件全部内容给拿出来，但它在打印行号的功能上，比cat更专业。
# 这个命令有-b（设置是否给空行编号）和-n（设置行号的显示位置以及是否补0）两个参数，具体请自行搜索。
nl -n rz result.txt

# 使用more和less命令分页查看文件。
# 其中more命令打开文件后默认只显示一屏内容，可以使用Enter键向下滚动一行，使用Space键向下滚动一屏，按下h显示帮助，q退出。
more result.txt

# 使用head和tail命令，它们一个是只查看的头几行（默认为10行，不足10行则显示全部），另一个是只查看尾几行。
# 加上-n参数可以设置查看多少行。
# 关于tail命令，它有一个很牛的参数-f，这个参数可以实现不停地读取某个文件的内容并显示，这可让我们动态查看日志起到实时监视的作用。
head result.txt

# 使用file命令查看文件的类型。
file result.txt
```
    语句解释：
    -  cat不适合打开大文件（比如有成百上千行的文件），大文件推荐使用vim。

## 用户及文件权限管理 ##
　　Linux 是一个可以实现多用户登陆的操作系统，比如“李雷”和“韩梅梅”都可以同时登陆同一台主机，他们共享一些主机的资源，但是由于 Linux 的 用户管理 和 权限机制 ，不同用户不可以轻易地查看、修改彼此的文件。
　　下面我们就来学习一下 Linux 下的账户管理的基础知识。

　　首先，来看看“用户”和“用户组”的概念：

    -  在Linux中，系统中默认就存在了很多用户（主要是系统用户），而且每个用户都有一个归属（用户组）。
    -  用户组简单地理解就是一组用户的集合，它们共享一些资源和权限，同时拥有私有资源。
    -  用户组就跟家的形式差不多，你的兄弟姐妹（不同的用户）属于同一个家（用户组），你们可以共同拥有这个家（共享资源），爸妈对待你们都一样（共享权限）。
    -  你偶尔写写日记，其他人未经允许不能查看（私有资源和权限）。
    -  当然一个用户是可以属于多个用户组的，正如你既属于家庭，又属于学校或公司。

<br>　　范例1：查看所有用户以及所有用户组。
``` shell
# cut是一个选取命令，主要用来截取字符串。下面代码的含义为：
# 依次检查/etc/passwd文件中的每一行，将行内的数据按照“:”字符拆分成若干组，然后把第1组给显示出来。
cut -d : -f 1 /etc/passwd

# 相应的如果想知道系统中当前有多少个用户组，则可以执行：
cut -d : -f 1 /etc/group
```

<br>　　范例2：查看当前用户。
``` shell
who am i

输出：
cutler   pts/0       2016-07-19 15:24 (:0)
```
    语句解释：
    -  输出的第一列表示打开当前伪终端的用户的用户名（要查看当前登录用户的用户名，去掉空格直接使用 whoami 即可）。
    -  第二列的 pts/0 中 pts 表示伪终端，你每打开一个终端就会产生一个伪终端， pts/0后面那个数字就表示打开的伪终端序号，你可以尝试再打开一个终端，然后在里面输入 who am i ，看第二列是不是就变成 pts/1 了。
    -  第三列则表示当前伪终端的启动时间。

<br>　　范例3：查看用户所在的用户组。
``` shell
groups cutler

输出：
cutler : cutler adm cdrom sudo dip plugdev lpadmin sambashare
```
    语句解释：
    -  其中冒号之前表示用户，后面表示该用户所属的用户组，可以看到cutler拥有8个用户组。
    -  每次新建用户如果不指定用户组的话，默认会自动创建一个与用户名相同的用户组。

<br>　　然后，来看看“root”用户的概念：

	-  在 Linux 系统里， root 用户拥有整个系统至高无上的权利，比如添加/删除用户。所有对象它都可以操作，所以很多黑客在入侵系统的时候，都要把权限提升到 root 权限。
	-  另外在Android中获得 root 权限之后就意味着已经获得了手机的最高权限，这时候你可以对手机中的任何文件（包括系统文件）执行任意操作。
	-  我们一般登录系统时都是以普通账户的身份登录的，当需要执行root用户才能执行的操作时（比如创建用户），就要用到 sudo 这个命令了。
	-  不过使用这个命令有两个大前提，一是你要知道当前登录用户的密码，二是当前用户必须在 sudo 用户组。

<br>　　范例4：创建新用户。
``` shell
sudo adduser huye
```
    语句解释：
    -  笔者当前登陆的用户是cutler，它并不是root用户，为了让cutler可以创建用户，就在adduser命令之前加上了sudo命令。
    -  按照提示给新用户设置密码，后面的选项的一些内容你可以选择直接回车使用默认值。
    -  adduser命令不但可以添加用户到系统，同时也会默认为新用户创建home目录，执行“ls /home”命令就可以看到。
    -  使用“su 用户名”可以切换用户，切换完之后就可以使用“whoami”命令来验证，还可以去测试新用户是否可以执行sudo命令。
    -  退出当前用户跟退出终端一样可以使用 exit。

<br>　　范例5：给新用户添加sudo用户组。
``` shell
sudo usermod -G sudo huye

# 使用下面的命令可以删除用户。
# sudo deluser huye --remove-home
```
    语句解释：
    -  使用 usermod 命令可以为用户添加用户组，同样使用该命令你必需有 root 权限。
    -  你可以直接使用 root 用户为其它用户添加用户组，或者用其它已经在 sudo 用户组的用户使用 sudo 命令获取权限来执行该命令。
    -  然后再登陆到huye上后，就可以使用sudo命令了，而且通过“groups huye”命令也可以看到它已经被添加到sudo组里了。

<br>　　最后，我们来看看Linux文件权限相关的知识。

<br>　　范例6：查看文件的权限。
``` shell
ls -l

总用量 192
drwxrwxr-x 12 cutler cutler   4096  7月 14 11:35 a
-rw-rw-r--  1 cutler cutler   1562  6月 20 09:00 a.py
-rw-rw-r--  1 cutler cutler  33850  6月 15 19:19 cuihu_1.xlsx
-rw-rw-r--  1 cutler cutler 141824  6月 17 11:21 cuihu_2.xls
drwxrwxr-x  4 cutler cutler   4096  7月 14 11:39 jira384229
drwxrwxr-x  5 cutler cutler   4096  7月 14 14:15 monkeytest
```
    语句解释：
    -  命令输出了7部分内容，从左到右依次为：文件的类型和权限，链接数，所有者，所属用户组，文件大小，最后修改日期，文件名。

　　文件的类型和权限由10个字符组成，第一个字符表示文件的类型，’d‘表示目录，’-‘表示文件，具体如下图所示：

<center>
![](/img/android/android_base04_01.png)
</center>

　　图释：

	-  关于文件类型，这里有一点你必需时刻牢记Linux 里面一切皆文件，正因为这一点才有了设备文件（ /dev 目录下有各种设备文件，大都跟具体的硬件设备相关）这一说。
	-  读权限，表示你可以使用 cat 之类的命令来读取某个文件的内容。
	-  写权限，表示你可以编辑和修改某个文件。
	-  执行权限，通常指可以运行的二进制程序文件或者脚本文件，如同 Windows 上的 'exe' 后缀的文件。
	-  你需要注意的一点是，一个目录要同时具有读权限和执行权限才可以打开，而一个目录要有写权限才允许在其中创建其它文件。


　　明白了文件权限的一些概念，我们顺带补充一下关于`ls`命令的一些其它常用的用法。

<br>　　范例7：`ls`命令。
``` shell
# 显示所有隐藏文件（Linux 下以 '.' 开头的文件为隐藏文件）。
ls -A

# 你也可以同时使用A和l参数。
ls -Al

# 显示文件的大小，单位kb。
ls -s

#显示所有文件的大小，并以普通人能看懂的方式呈现。
ls -AsSh
```
    语句解释：
    -  大S为按文件大小排序，h用来在文件大小后面加上单位。

<br>　　如果你有一个自己的文件不想被其他用户读、写、执行，那么就需要对文件的权限做修改，这里有两种方式。
　　范例8：修改文件的访问权限。
``` shell
# 方式一：二进制数字表示。

# 每个文件都有的三组权限（拥有者，所属用户组，其他用户,记住这个顺序是一定的），我们用3位二进制数字表示。
# 对于"rwx"可以得到111，也就是一个十进制的'7'，因此“rwx------”对应的数字权限就应该是700。
chmod 700 a.txt


# 方式二：加减赋值操作，自己查去。
```
    语句解释：
    -  使用chmod命令来修改文件的权限。

<br><br>
　　







